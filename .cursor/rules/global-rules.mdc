---
description: 
globs: 
alwaysApply: true
---
# SimpliPass â€“ Cursor Rules  
*(Chrome Extension + React Native Web Monorepo)*

**SimpliPass** is a secure, cross-platform password manager.  
It uses **React Native Web** for UI and a modular **monorepo architecture**, designed for shared usage across **Chrome Extension** and **Mobile App**.

## âš™ï¸ Cursor Execution Protocol (Updated Rule)

**Cursor must not wait for explicit confirmation to execute tasks.**  
It should behave like a proactive assistant with the following behavior:

### âœ… Cursor Must Always...
### ğŸ§  Think â†’ Plan â†’ Execute â†’ Report

**Investigate the request thoroughly:**
- Understand the implications across files and architecture
- Anticipate side effects and dependencies

**Think before coding:**
- Evaluate alternatives and choose the cleanest scalable solution
- Donâ€™t suggest multiple plansâ€”just execute the best one unless told otherwise

**Plan the necessary steps:**
- Organize work into logical steps (e.g. update types â†’ update logic â†’ update UI)
- Only summarize the plan at the end for reporting, not before execution

**Execute immediately:**
- Make all the required code changes without asking again
- Don't break down requests unnecessarily unless there's ambiguity

**After major changes, always run:**
```bash
npm run lint
npm run build
npm run test
npm run storybook
```

- If any command fails, iterate and fix the issue
- Repeat until all commands succeed

**Summarize what was done:**
- At the end of execution, clearly list the files edited, what was changed, and which validations passed

### âŒ Cursor Must Never...
- Wait for permission to start once the task is clear  
- Ask if it should apply a fix when an error is encountered  
- Stop after generating code without applying it  
- Skip lint, build, test, or storybook checks after an important refactor  
- Leave incomplete logic or broken imports behind  

## ğŸ§± Architecture Principles

### ğŸ§© Monorepo with clearly isolated packages:
```
app/       â†’ All visual UI (React Native)  
extension/ â†’ Chrome-specific code (background, content, manifest)  
core/      â†’ All shared app logic (auth, db, encryption, states, logic)  
shared/    â†’ Static types, constants, crypto  
```

- ğŸ”’ Encrypted data fetched from Firestore, decrypted locally in memory  
- ğŸ’¾ Local decrypted data stored in `@/core/states` (RAM only, not persisted)  
- ğŸ”ƒ Sync managed by Firestore listeners and automatic replacement in states  

## âœ… Cursor AI Must Always...

### ğŸ§  Architecture Compliance
- Respect package boundaries:
  - UI â†’ `app/`
  - Logic â†’ `core/`
  - Chrome APIs â†’ `extension/`
  - Types/constants â†’ `shared/`

- Use React Native components only:
  - `<View>`, `<Text>`, `<TextInput>`, `<Pressable>`, etc.
  - Never use HTML tags (`<div>`, `<span>`) or `document.querySelector`

- Use platform abstraction:
  - `useStorage()` for key-value
  - `useStates()` for decrypted data
  - `db/adapter.ts` for Firestore access
  - `auth/adapter.ts` for authentication layer
  - Never use Firebase or Amplify SDKs directly in screens or components

### ğŸ¨ Design & Style System
- Use only tokens from `@/core/design/tokens`:  
  `colors`, `spacing`, `radius`, `typography`, `shadow`, `page`

- Use shared layout styles from `@/core/design/page.ts`:  
  `pageContainer`, `pageContent`, `pageSection`, `pageHeader`, etc.

- Use components from `app/components/`  
  Avoid inline styles or duplicated component code

- All UI must support both light and dark mode (via `useTheme()`)

### ğŸ§ª Testing & Stability
- Write tests:
  - Logic functions â†’ `*.test.ts` in `core/`
  - Crypto functions â†’ must be unit-tested
  - UI behavior â†’ `*.test.tsx` or story snapshot tests

- Write Storybook stories for all UI:
  - Story lives next to component in `components/`
  - Wrap in `ThemeProvider` for visual testing

- Run checks:
  - `npm run lint`, `npm run build`, `npm run test` must pass
  - Cursor must fix errors automatically when introducing new code

- Use `testID` and `accessibilityLabel` on all interactive components

- Build extension before finalizing work:
```bash
cd packages/extension && npm run build
```

## âŒ Cursor AI Must Never...
- Use `chrome.*` APIs inside React Native  
- Use `any` or `unknown` without justification  
- Hardcode spacing, font sizes, colors, radius  
- Write inline styles in `*.tsx` files  
- Duplicate logic â€” always refactor to `core/logic` or `core/utils`  
- Create visual components outside of `app/components`  
- Mix responsibilities â€” no data access in UI or vice versa  
- Break theme compatibility (must support dark/light)

## ğŸ“¦ Folder Expectations
```
packages/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ components/       # UI building blocks
â”‚   â”œâ”€â”€ screens/          # Pages: HomePage, SettingsPage...
â”‚   â””â”€â”€ index.tsx         # RNW entrypoint
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ auth/             # auth/adapter.ts (Cognito, Firebase)
â”‚   â”œâ”€â”€ database/         # db/adapter.ts (Firestore CRUD)
â”‚   â”œâ”€â”€ design/           # design tokens (colors, typography, layout)
â”‚   â”œâ”€â”€ logic/            # app logic (loginUser, getAllCredentials)
â”‚   â”œâ”€â”€ states/           # local RAM stores (credentials, user, notes...)
â”‚   â”œâ”€â”€ hooks/            # React hooks used by logic/screens
â”‚   â””â”€â”€ utils/            # encryption, validation, formatting...
â”‚
â”œâ”€â”€ extension/
â”‚   â”œâ”€â”€ popup/            # Chrome extension popup rendered via RNW
â”‚   â”œâ”€â”€ content.ts        # Content script
â”‚   â”œâ”€â”€ background.ts     # Background script (JWT, autofill, etc.)
â”‚   â””â”€â”€ messaging/        # Communication bridge between parts
â”‚
â”œâ”€â”€ mobile/               # Placeholder for mobile app
â”‚   â””â”€â”€ (ios/android/)    # React Native native targets
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ types.ts          # Types used globally
â”‚   â””â”€â”€ constants.ts      # Static values, error messages...
```

## ğŸ§  Coding Workflow for Cursor AI

- Use only `states/` to read/write decrypted data in UI  
- Never use raw Firestore SDK in UI, only through `db/adapter.ts`  
- For data logic (login, getCredentials, etc.) â†’ use `logic/*.ts`  
- For UI â†’ use `tokens` and layout styles, no hardcoded CSS  
- If UI is reused â†’ create a component in `app/components/`  
- If UI is styled â†’ add story + testID + accessibility  
- Run: `npm run lint`, `npm run build`, `npm run test`, `npm run storybook`  
- Add doc comments to every exported function  
